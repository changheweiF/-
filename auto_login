#!/bin/sh /etc/rc.common
# 校园网自动登录 OpenWrt 启动脚本
START=99
STOP=15
USE_PROCD=1

APPNAME="campus_net"
DAEMON="/etc/auto_login_daemon.sh"
PIDFILE="/var/run/${APPNAME}.pid"
LOGDIR="/var/log/campus_net"

EXTRA_COMMANDS="status"
EXTRA_HELP="    status    显示运行状态"

start_service() {
    mkdir -p /var/run "$LOGDIR"
    procd_open_instance
    procd_set_param command "$DAEMON"
    procd_set_param respawn 5 10 0
    procd_set_param stdout 1
    procd_set_param stderr 1
    procd_close_instance
    logger -t "$APPNAME" "自动登录守护进程已启动"
}

stop_service() {
    killall -q $(basename "$DAEMON")
    logger -t "$APPNAME" "自动登录守护进程已停止"
}

status() {
    if pgrep -f "$DAEMON" >/dev/null; then
        echo "$APPNAME 正在运行"
    else
        echo "$APPNAME 未运行"
    fi
}
